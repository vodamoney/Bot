<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vodamoney • Invista e Ganhe 5MT por dia</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; }
    :root {
      --primary: #c62828;
      --primary-dark: #b71c1c;
      --primary-light: #ef5350;
      --accent: #ff5252;
      --success: #2e7d32;
      --warning: #ff6f00;
      --bg-light: #fff5f5;
    }
    body {
      background: linear-gradient(135deg, var(--bg-light) 0%, #ffebee 100%);
      font-family: 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      padding-bottom: 20px;
    }
    .navbar {
      background: linear-gradient(to right, var(--primary), var(--primary-light)) !important;
      box-shadow: 0 4px 12px rgba(198,40,40,0.3);
    }
    .navbar-brand { font-weight: 700; color: white !important; font-size: 1.7rem; letter-spacing: -0.5px; }
    .navbar-brand i { margin-right: 8px; color: #ffd700; }

    .card {
      border: none;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(198,40,40,0.15);
      transition: transform 0.2s ease, box-shadow 0.2s;
      border-top: 4px solid var(--primary);
      overflow: hidden;
    }
    .card:hover { transform: translateY(-6px); box-shadow: 0 20px 35px rgba(198,40,40,0.25); }
    .investment-card {
      background: linear-gradient(145deg, var(--primary-dark), var(--primary));
      color: white;
      border-top: none;
    }
    .investment-card .card-title { color: white; background: none; -webkit-text-fill-color: white; }

    .btn-primary {
      background: linear-gradient(to right, var(--primary), #d32f2f);
      border: none;
      border-radius: 40px;
      padding: 12px 28px;
      font-weight: 600;
      box-shadow: 0 8px 16px rgba(198,40,40,0.3);
    }
    .btn-primary:hover { background: linear-gradient(to right, var(--primary-dark), var(--primary)); transform: scale(1.02); }
    .btn-success {
      background: linear-gradient(to right, #2e7d32, #4caf50);
      border-radius: 40px;
      border: none;
      font-weight: 600;
    }
    .btn-warning {
      background: linear-gradient(to right, #ff6f00, #ffb300);
      border: none;
      color: #000;
      font-weight: 600;
      border-radius: 40px;
    }
    .btn-info {
      background: linear-gradient(to right, #0288d1, #29b6f6);
      border: none;
      color: white;
      border-radius: 40px;
      font-weight: 600;
    }

    .modal-content { border-radius: 24px; border: none; }
    .modal-header {
      background: linear-gradient(to right, var(--primary), #d32f2f);
      color: white;
      border-radius: 24px 24px 0 0 !important;
      border-bottom: none;
    }
    .modal-header .btn-close { filter: brightness(0) invert(1); opacity: 0.9; }
    .form-control, .form-select {
      border-radius: 14px;
      border: 1px solid #e0a0a0;
      padding: 12px 16px;
    }
    .form-control:focus, .form-select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 0.25rem rgba(255,82,82,0.25);
    }

    .whatsapp-float {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 65px;
      height: 65px;
      background: linear-gradient(145deg, #25d366, #128C7E);
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.2rem;
      box-shadow: 0 10px 25px rgba(37,211,102,0.4);
      z-index: 100;
      transition: 0.25s;
      text-decoration: none;
    }
    .whatsapp-float:hover { transform: scale(1.1) rotate(5deg); color: white; }

    .dashboard-stats {
      font-size: 2.3rem;
      font-weight: 800;
      color: var(--primary-dark);
      line-height: 1.2;
    }
    .countdown-timer {
      font-size: 2rem;
      font-weight: 700;
      background: #ffeaea;
      padding: 8px 20px;
      border-radius: 60px;
      display: inline-block;
      border: 2px solid var(--primary);
      color: var(--primary-dark);
    }
    .merchant-info {
      background: #fef2f2;
      border-left: 6px solid var(--primary);
      border-radius: 18px;
      padding: 18px;
    }
    .nav-tabs .nav-link.active {
      background: white;
      border-bottom-color: white;
      color: var(--primary);
      font-weight: 700;
      border-top: 3px solid var(--primary);
    }
    .nav-tabs .nav-link { color: #555; font-weight: 500; border: none; padding: 12px 20px; }
    .tab-content {
      background: white;
      border-radius: 0 0 24px 24px;
      padding: 30px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.05);
    }
    .alert-no-funds {
      background: linear-gradient(145deg, #ff5252, #ff8a80);
      color: white;
      border-radius: 20px;
      padding: 20px;
      border-left: 8px solid #b71c1c;
    }
    .investment-disabled { opacity: 0.6; pointer-events: none; filter: grayscale(0.4); }
    .status-badge {
      padding: 6px 16px;
      border-radius: 40px;
      font-weight: 600;
      font-size: 0.8rem;
      display: inline-block;
    }
    .status-pendente { background: #fff3e0; color: #e65100; border: 1px solid #ffb74d; }
    .status-aprovado, .status-completo { background: #e8f5e9; color: #1b5e20; border: 1px solid #81c784; }
    .status-recusado { background: #ffebee; color: #b71c1c; border: 1px solid #ef5350; }
    .investment-guide {
      background: linear-gradient(145deg, var(--primary), #ef5350);
      color: white;
      border-radius: 20px;
      padding: 18px 25px;
      margin-bottom: 30px;
    }
    .investment-guide h5 { color: white; -webkit-text-fill-color: white; }
    .text-gradient {
      background: linear-gradient(145deg, #b71c1c, #ff5252);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }
    .input-group-text {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 0 14px 14px 0;
      font-weight: 600;
    }
    .saldo-destaque { color: #2e7d32 !important; text-shadow: 0 2px 8px rgba(46,125,50,0.2); }
    .daily-profit { color: #2e7d32; font-weight: 600; background: #e0f2e0; padding: 4px 12px; border-radius: 30px; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark shadow">
    <div class="container">
      <a class="navbar-brand" href="#"><i class="fas fa-bolt"></i> Vodamoney </a>
      <div id="userSection" class="d-flex"></div>
    </div>
  </nav>

  <!-- Modais -->
  <div class="modal fade" id="loginModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Entrar</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form id="loginForm"><div class="mb-3"><label>Email</label><input type="email" class="form-control" id="loginEmail" value="" required></div><div class="mb-3"><label>Senha</label><input type="password" class="form-control" id="loginPassword" value="123456" required></div><button type="submit" class="btn btn-primary w-100">Entrar</button></form><div class="text-center mt-3"><button class="btn btn-link" onclick="showRegister()">Criar conta</button></div></div></div></div></div>

  <div class="modal fade" id="registerModal" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Registar</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><form id="registerForm"><div class="row"><div class="col-md-6 mb-3"><label>Nome Completo</label><input type="text" class="form-control" id="regNome" required></div><div class="col-md-6 mb-3"><label>Email</label><input type="email" class="form-control" id="regEmail" required></div></div><div class="row"><div class="col-md-6 mb-3"><label>Telefone</label><input type="tel" class="form-control" id="regTelefone" required></div><div class="col-md-6 mb-3"><label>Senha</label><input type="password" class="form-control" id="regSenha" required></div></div><div class="row"><div class="col-md-6 mb-3"><label>Província</label><select class="form-select" id="regProvincia" onchange="loadDistritos()"><option value="">Selecione...</option><option value="Maputo">Maputo</option><option value="Gaza">Gaza</option><option value="Inhambane">Inhambane</option><option value="Sofala">Sofala</option><option value="Manica">Manica</option><option value="Tete">Tete</option><option value="Zambézia">Zambézia</option><option value="Nampula">Nampula</option><option value="Cabo Delgado">Cabo Delgado</option><option value="Niassa">Niassa</option></select></div><div class="col-md-6 mb-3"><label>Distrito</label><select class="form-select" id="regDistrito" required><option value="">...</option></select></div></div><div class="row"><div class="col-md-6 mb-3"><label>Sexo</label><select class="form-select" id="regSexo"><option>Masculino</option><option>Feminino</option><option>Outro</option></select></div><div class="col-md-6 mb-3"><label>Profissão</label><select class="form-select" id="regProfissao"><option>Estudante</option><option>Empregado</option><option>Empresário</option><option>Outro</option></select></div></div><button type="submit" class="btn btn-success w-100">Criar conta</button></form></div></div></div></div>

  <div class="modal fade" id="paymentInstructionsModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Instruções Pagamento</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="merchant-info"><h5><i class="fas fa-store"></i> Dados</h5><p><strong>Nome:</strong> Vodamoney Investimentos Lda</p><p><strong>NUIT:</strong> 010454205</p><p><strong>Email:</strong> pagamentos@vodamoney.co.mz</p></div><div class="alert alert-info"><i class="fas fa-phone-alt"></i> <strong>Paga Fácil Código:</strong> 1216691<br><strong>Comerciante:</strong> Momade Venda Online</div><div class="alert alert-warning"><i class="fas fa-clock"></i> Saldo válido por <strong>6 horas</strong> após aprovação.</div><hr><h6>Passos:</h6><ol><li>Pague para o código acima</li><li>Guarde o ID da transação</li><li>Preencha o formulário de depósito</li></ol><button class="btn btn-primary w-100" data-bs-dismiss="modal">Entendi</button></div></div></div></div>

  <!-- Conteúdo principal -->
  <div class="container mt-4">
    <!-- Dashboard (pós-login) -->
    <div id="dashboard" class="d-none">
      <div class="row mb-4">
        <div class="col-md-4"><div class="card text-center p-3"><h6>Saldo Disponível</h6><div class="dashboard-stats" id="saldo">0.00 MT</div><small class="text-muted" id="saldoValidade"></small><small id="saldoDetalhes"></small></div></div>
        <div class="col-md-4"><div class="card text-center p-3"><h6>Total Investido</h6><div class="dashboard-stats" id="totalInvestido">0.00 MT</div></div></div>
        <div class="col-md-4"><div class="card text-center p-3"><h6>Próximo Ganho (5MT)</h6><div class="countdown-timer" id="countdown">00:00:00</div><span class="daily-profit" id="proximoGanho"></span></div></div>
      </div>

      <ul class="nav nav-tabs" id="dashboardTabs">
        <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#investimentos">Investir</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#depositos">Depositar</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#levantamentos">Levantar</button></li>
        <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#historico">Histórico</button></li>
        <li class="nav-item"><button class="nav-link" onclick="logout()">Sair</button></li>
      </ul>

      <div class="tab-content">
        <!-- Investimentos -->
        <div class="tab-pane fade show active" id="investimentos">
          <div id="investmentAlerts"></div>
          <div class="investment-guide"><h5><i class="fas fa-info-circle"></i> Apenas um investimento por usuário</h5><ol><li>Deposite e aguarde aprovação</li><li>Invista com saldo (mínimo 100 MT)</li><li>Receba <strong>5 MT por dia</strong> no saldo</li></ol></div>
          <h4 class="mb-4">Pacote Mineração Diária - 5MT/dia</h4>
          <div class="row"><div class="col-md-6"><div class="card investment-card" id="miningCard"><div class="card-body"><h5 class="card-title">Mineração Diária 5MT</h5><p><i class="fas fa-infinity"></i> Ganho fixo: <strong>5.00 MT por dia</strong><br><i class="fas fa-coins"></i> Investimento mínimo: 100 MT<br><i class="fas fa-ban"></i> Único por usuário</p><div class="input-group mb-3"><input type="number" id="investAmount" value="100" min="100" class="form-control"><span class="input-group-text">MT</span></div><button class="btn btn-light w-100" id="investButton" onclick="investir()">Investir Agora</button></div></div></div></div>
        </div>

        <!-- Depósitos -->
        <div class="tab-pane fade" id="depositos">
          <h4 class="mb-3">Fazer Depósito</h4>
          <button class="btn btn-info mb-4" onclick="showPaymentInstructions()"><i class="fas fa-info-circle"></i> Instruções</button>
          <form id="depositForm"><div class="row"><div class="col-md-6 mb-3"><label>Método</label><select class="form-select" id="depositMethod"><option value="paga-facil">Paga Fácil</option></select></div><div class="col-md-6 mb-3"><label>Valor (MT)</label><input type="number" id="depositValue" min="100" class="form-control" required></div></div><div class="mb-3"><label>ID Transação</label><input type="text" id="transactionId" class="form-control" required placeholder="Código da operação"></div><div class="mb-3"><label>Número que pagou</label><input type="tel" id="payerNumber" class="form-control" required placeholder=""></div><div class="alert alert-warning"><i class="fas fa-clock"></i> Saldo expira em 6h após aprovação.</div><button type="submit" class="btn btn-primary">Submeter Depósito</button></form>
        </div>

        <!-- Levantamentos -->
        <div class="tab-pane fade" id="levantamentos">
          <h4>Solicitar Levantamento</h4>
          <form id="withdrawForm" class="mt-3"><div class="row"><div class="col-md-6 mb-3"><label>Método</label><select class="form-select" id="withdrawMethod"><option value="mpesa">M-Pesa</option></select></div><div class="col-md-6 mb-3"><label>Valor (MT)</label><input type="number" id="withdrawValue" min="5" class="form-control" required></div></div><div class="mb-3"><label>Nome do Receptor</label><input type="text" id="receiverName" class="form-control" required></div><div class="mb-3"><label>Número da conta</label><input type="tel" id="receiverNumber" class="form-control" required></div><button type="submit" class="btn btn-success">Solicitar</button></form>
        </div>

        <!-- Histórico -->
        <div class="tab-pane fade" id="historico">
          <h4>Transações</h4>
          <div class="table-responsive"><table class="table table-hover"><thead><tr><th>Data</th><th>Tipo</th><th>Descrição</th><th>Valor</th><th>Status</th></tr></thead><tbody id="transactionHistory"></tbody></table></div>
        </div>
      </div>
    </div>

    <!-- Página Inicial (anónimo) -->
    <div id="homePage">
      <div class="row align-items-center">
        <div class="col-md-6">
          <h1 class="display-4 text-gradient">Vodamoney <br>5 MT por dia</h1>
          <p class="lead">Comece com 100 MT e receba <strong>5 MT por dia</strong> para sempre. Rendimento diário garantido de 5%.</p>
          <div class="card p-3 mb-4"><h5><i class="fas fa-check-circle text-success"></i> Como funciona:</h5><ul class="list-unstyled"><li><i class="fas fa-check text-success"></i> Depósito válido por 6h</li><li><i class="fas fa-check text-success"></i> Apenas um investimento por pessoa</li><li><i class="fas fa-check text-success"></i> Ganhos diários automáticos de 5MT</li></ul></div>
          <button class="btn btn-primary btn-lg" onclick="showRegister()"><i class="fas fa-user-plus"></i> Começar</button>
          <button class="btn btn-outline-primary btn-lg ms-2" onclick="showLogin()"><i class="fas fa-sign-in-alt"></i> Entrar</button>
        </div>
        <div class="col-md-6"><div class="card investment-card p-4 text-center"><i class="fas fa-gem fa-4x mb-3"></i><h2>5.00 MT por dia</h2><p>Investimento único • 5% ao dia</p></div></div>
      </div>
    </div>
  </div>

  <a href="https://wa.me/258858867098?text=Olá Vodamoney preciso de ajuda" class="whatsapp-float" target="_blank"><i class="fab fa-whatsapp"></i></a>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    (function() {
      // ---------- data layer ----------
      let users = JSON.parse(localStorage.getItem('vodamoney_users')) || [];
      let transactions = JSON.parse(localStorage.getItem('vodamoney_transactions')) || [];
      let investments = JSON.parse(localStorage.getItem('vodamoney_investments')) || [];
      let currentUser = JSON.parse(localStorage.getItem('vodamoney_currentUser')) || null;

      const distritosPorProvincia = {
        'Maputo': ['Maputo Cidade','Matola','Boane','Manhiça','Marracuene'],
        'Gaza': ['Xai-Xai','Chókwè','Chibuto','Macia','Bilene'],
        'Inhambane': ['Inhambane','Maxixe','Vilanculos','Massinga'],
        'Sofala': ['Beira','Dondo','Nhamatanda','Búzi'],
        'Manica': ['Chimoio','Gondola','Manica','Sussundenga'],
        'Tete': ['Tete','Moatize','Angónia','Zumbo'],
        'Zambézia': ['Quelimane','Mocuba','Gurúè','Milange'],
        'Nampula': ['Nampula','Angoche','Moma','Mogovolas'],
        'Cabo Delgado': ['Pemba','Montepuez','Mueda','Macomia'],
        'Niassa': ['Lichinga','Cuamba','Sanga','Marrupa']
      };

      // se não houver users, cria um de teste
      if (users.length === 0) {
        const data = new Date(); data.setHours(data.getHours()+6);
        users.push({
          id: 1,
          nome: 'Usuário Teste',
          email: 'teste@email.com',
          senha: '123456',
          telefone: '841234567',
          provincia: 'Maputo',
          distrito: 'Matola',
          sexo: 'Masculino',
          profissao: 'Empregado',
          saldo: 0.00,
          dataRegisto: new Date().toISOString(),
          saldoExpira: data.toISOString(),
          jaInvestiu: false,
          primeiroDeposito: true
        });
        transactions.push({ id: Date.now()-1000, userId:1, tipo:'deposito', descricao:'Depósito Emola', valor:0, data:new Date().toISOString(), status:'aprovado' });
        localStorage.setItem('vodamoney_users', JSON.stringify(users));
        localStorage.setItem('vodamoney_transactions', JSON.stringify(transactions));
      }

      function saveAll() {
        localStorage.setItem('vodamoney_users', JSON.stringify(users));
        localStorage.setItem('vodamoney_transactions', JSON.stringify(transactions));
        localStorage.setItem('vodamoney_investments', JSON.stringify(investments));
        localStorage.setItem('vodamoney_currentUser', JSON.stringify(currentUser));
      }

      // helpers
      function getUser(id) { return users.find(u => u.id === id); }
      function hasApprovedDeposit(uid) { return transactions.some(t => t.userId === uid && t.tipo === 'deposito' && t.status === 'aprovado'); }
      function getSaldo(uid) {
        let u = getUser(uid); if (!u) return 0;
        if (u.saldoExpira && new Date() > new Date(u.saldoExpira)) { expirarSaldo(uid); u = getUser(uid); }
        return Number(u.saldo) || 0;
      }
      function expirarSaldo(uid) {
        let u = getUser(uid); if (!u) return;
        if (u.saldo > 0) {
          transactions.push({ id:Date.now(), userId:uid, tipo:'devolucao', descricao:'Saldo expirado', valor:-u.saldo, data:new Date().toISOString(), status:'completo' });
          u.saldo = 0;
        }
        u.saldoExpira = null;
        saveAll();
      }
      function tempoRestante(uid) {
        let u = getUser(uid); if (!u || !u.saldoExpira) return null;
        let diff = new Date(u.saldoExpira) - new Date();
        return diff > 0 ? diff : null;
      }
      function getInvestimentosUser(uid) { return investments.filter(i => i.userId === uid && i.ativo); }
      function totalInvestido(uid) { return getInvestimentosUser(uid).reduce((s,i)=> s+i.valor,0); }
      function ganhoDiario(uid) { return getInvestimentosUser(uid).length * 5; } // ALTERADO PARA 5 MT
      function aplicarGanhos(uid) {
        let u = getUser(uid); if (!u) return 0;
        let userInvest = investments.filter(i => i.userId === uid && i.ativo);
        let totalGanho = 0;
        let agora = new Date();
        userInvest.forEach(inv => {
          let ultimo = new Date(inv.ultimoPagamento);
          let horas = (agora - ultimo) / (1000*60*60);
          if (horas >= 24) {
            let dias = Math.floor(horas/24);
            let ganho = dias * 5; // ALTERADO PARA 5 MT
            totalGanho += ganho;
            inv.ultimoPagamento = new Date(ultimo.getTime() + dias*24*60*60*1000).toISOString();
          }
        });
        if (totalGanho > 0) {
          u.saldo = Number(u.saldo) + totalGanho;
          transactions.push({ id:Date.now(), userId:uid, tipo:'ganho', descricao:`Ganho diário (${totalGanho} MT)`, valor:totalGanho, data:new Date().toISOString(), status:'completo' });
          saveAll();
        }
        return totalGanho;
      }

      // ----- frontend funções -----
      window.showLogin = () => new bootstrap.Modal(document.getElementById('loginModal')).show();
      window.showRegister = () => new bootstrap.Modal(document.getElementById('registerModal')).show();
      window.showPaymentInstructions = () => new bootstrap.Modal(document.getElementById('paymentInstructionsModal')).show();
      window.loadDistritos = function() {
        let prov = document.getElementById('regProvincia').value;
        let distro = document.getElementById('regDistrito');
        distro.innerHTML = '<option value="">Selecione...</option>';
        if (prov && distritosPorProvincia[prov]) {
          distritosPorProvincia[prov].forEach(d => distro.add(new Option(d, d)));
        }
      };

      function updateUI() {
        let userSection = document.getElementById('userSection');
        let homePage = document.getElementById('homePage');
        let dashboard = document.getElementById('dashboard');

        if (currentUser) {
          let primeiro = currentUser.nome.split(' ')[0];
          userSection.innerHTML = `<div class="d-flex align-items-center"><span class="me-3 text-white">Olá, ${primeiro}</span><div class="dropdown"><button class="btn btn-outline-light btn-sm dropdown-toggle" data-bs-toggle="dropdown"><i class="fas fa-user"></i></button><ul class="dropdown-menu"><li><button class="dropdown-item" onclick="logout()">Sair</button></li></ul></div></div>`;
          homePage.classList.add('d-none');
          dashboard.classList.remove('d-none');
          refreshDashboard();
        } else {
          userSection.innerHTML = `<button class="btn btn-outline-light" onclick="showLogin()"><i class="fas fa-sign-in-alt"></i> Entrar</button>`;
          homePage.classList.remove('d-none');
          dashboard.classList.add('d-none');
        }
      }

      function refreshDashboard() {
        if (!currentUser) return;
        let uid = currentUser.id;
        let ganhosAgora = aplicarGanhos(uid); // aplica pendentes
        currentUser = getUser(uid); // atualiza objeto

        let saldo = getSaldo(uid);
        let totalInv = totalInvestido(uid);
        let diario = ganhoDiario(uid);

        document.getElementById('saldo').innerHTML = saldo.toFixed(2) + ' MT';
        document.getElementById('totalInvestido').innerHTML = totalInv.toFixed(2) + ' MT';

        let tempo = tempoRestante(uid);
        if (tempo && saldo > 0) {
          let h = Math.floor(tempo/3600000), m = Math.floor((tempo%3600000)/60000);
          document.getElementById('saldoValidade').innerHTML = `<span class="text-warning">Válido ${h}h ${m}min</span>`;
        } else { document.getElementById('saldoValidade').innerHTML = ''; }

        if (ganhosAgora > 0) {
          document.getElementById('saldoDetalhes').innerHTML = `<span class="text-success">+${ganhosAgora.toFixed(2)} MT agora</span>`;
          setTimeout(()=> document.getElementById('saldoDetalhes').innerHTML = '', 5000);
        } else document.getElementById('saldoDetalhes').innerHTML = '';

        // botão / alerta investimento
        let investBtn = document.getElementById('investButton');
        let miningCard = document.getElementById('miningCard');
        let alertsDiv = document.getElementById('investmentAlerts');
        let amountInput = document.getElementById('investAmount');

        if (currentUser.jaInvestiu) {
          alertsDiv.innerHTML = `<div class="alert alert-success"><i class="fas fa-check-circle"></i> Investimento único já realizado. Receba <strong>5 MT/dia</strong>.</div>`;
          investBtn.disabled = true;
          miningCard.classList.add('investment-disabled');
          investBtn.innerHTML = '<i class="fas fa-lock"></i> Único realizado';
          amountInput.disabled = true;
        } else if (!hasApprovedDeposit(uid)) {
          alertsDiv.innerHTML = `<div class="alert-no-funds"><h5><i class="fas fa-exclamation-triangle"></i> Precisa de um depósito aprovado</h5><button class="btn btn-warning" onclick="showDepositTab()">Ir para Depositar</button></div>`;
          investBtn.disabled = true;
          miningCard.classList.add('investment-disabled');
        } else if (saldo < 100) {
          alertsDiv.innerHTML = `<div class="alert alert-warning">Saldo insuficiente (${saldo.toFixed(2)} MT). Mínimo 100 MT.</div>`;
          investBtn.disabled = true;
          investBtn.innerHTML = '<i class="fas fa-lock"></i> Saldo baixo';
        } else {
          alertsDiv.innerHTML = '';
          investBtn.disabled = false;
          miningCard.classList.remove('investment-disabled');
          investBtn.innerHTML = 'Investir Agora (Único)';
        }

        // histórico
        let userTrans = transactions.filter(t => t.userId === uid).sort((a,b)=>new Date(b.data)-new Date(a.data));
        let tbody = document.getElementById('transactionHistory');
        if (userTrans.length === 0) tbody.innerHTML = '<tr><td colspan="5" class="text-center">Nada ainda</td></tr>';
        else {
          tbody.innerHTML = userTrans.map(t => {
            let statusClass = t.status === 'aprovado' || t.status === 'completo' ? 'status-aprovado' : t.status === 'pendente' ? 'status-pendente' : 'status-recusado';
            let sinal = t.valor > 0 ? 'text-success' : 'text-danger';
            return `<tr><td>${new Date(t.data).toLocaleString('pt-MZ')}</td><td>${t.tipo}</td><td>${t.descricao}</td><td class="${sinal} fw-bold">${t.valor > 0 ? '+' : ''}${t.valor.toFixed(2)} MT</td><td><span class="status-badge ${statusClass}">${t.status || 'pendente'}</span></td></tr>`;
          }).join('');
        }

        startCountdown();
      }

      function startCountdown() {
        if (window.countdownInterval) clearInterval(window.countdownInterval);
        window.countdownInterval = setInterval(() => {
          if (!currentUser) return;
          let uid = currentUser.id;
          let invs = getInvestimentosUser(uid);
          if (invs.length === 0) {
            document.getElementById('countdown').innerText = '--:--:--';
            document.getElementById('proximoGanho').innerHTML = '';
            return;
          }
          let ultimo = new Date(invs[0].ultimoPagamento);
          let prox = new Date(ultimo.getTime() + 24*60*60*1000);
          let diff = prox - new Date();
          if (diff <= 0) { refreshDashboard(); return; }
          let h = Math.floor(diff/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
          document.getElementById('countdown').innerText = `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
          document.getElementById('proximoGanho').innerHTML = `<span>próximo: 5 MT</span>`;
        }, 1000);
      }

      window.showDepositTab = function() {
        let tab = new bootstrap.Tab(document.querySelector('[data-bs-target="#depositos"]'));
        tab.show();
      };

      window.investir = function() {
        if (!currentUser) return alert('Faça login');
        let uid = currentUser.id;
        let valor = parseFloat(document.getElementById('investAmount').value);
        if (valor < 100 || isNaN(valor)) return alert('Mínimo 100 MT');
        if (currentUser.jaInvestiu) return alert('Você já investiu. Permitido apenas um.');
        if (!hasApprovedDeposit(uid)) return alert('Necessário depósito aprovado.');
        let saldoAtual = getSaldo(uid);
        if (saldoAtual < valor) return alert(`Saldo insuficiente: ${saldoAtual.toFixed(2)} MT`);

        // criar investimento
        let inv = { id:Date.now(), userId:uid, tipo:'mining', valor, dataInicio:new Date().toISOString(), ganhoDiario:5, ultimoPagamento:new Date().toISOString(), ativo:true };
        investments.push(inv);
        let u = getUser(uid);
        u.jaInvestiu = true;
        u.saldo = Number(u.saldo) - valor;
        transactions.push({ id:Date.now(), userId:uid, tipo:'investimento', descricao:'Investimento mineração', valor:-valor, data:new Date().toISOString(), status:'completo' });
        saveAll();
        currentUser = u;
        refreshDashboard();
        alert('Investimento realizado! Ganhos diários de 5 MT.');
      };

      window.logout = function() {
        currentUser = null;
        localStorage.removeItem('vodamoney_currentUser');
        if (window.countdownInterval) clearInterval(window.countdownInterval);
        updateUI();
      };

      // Event listeners
      document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        let email = document.getElementById('loginEmail').value;
        let pass = document.getElementById('loginPassword').value;
        let user = users.find(u => u.email === email && u.senha === pass);
        if (user) {
          currentUser = user;
          saveAll();
          bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
          updateUI();
        } else alert('Credenciais inválidas. Use teste@email.com / 123456');
      });

      document.getElementById('registerForm').addEventListener('submit', function(e) {
        e.preventDefault();
        let novo = {
          id: Date.now(),
          nome: document.getElementById('regNome').value,
          email: document.getElementById('regEmail').value,
          telefone: document.getElementById('regTelefone').value,
          senha: document.getElementById('regSenha').value,
          provincia: document.getElementById('regProvincia').value,
          distrito: document.getElementById('regDistrito').value,
          sexo: document.getElementById('regSexo').value,
          profissao: document.getElementById('regProfissao').value,
          saldo: 0.00,
          dataRegisto: new Date().toISOString(),
          saldoExpira: null,
          jaInvestiu: false,
          primeiroDeposito: false
        };
        users.push(novo);
        currentUser = novo;
        saveAll();
        bootstrap.Modal.getInstance(document.getElementById('registerModal')).hide();
        updateUI();
        showPaymentInstructions();
        document.getElementById('registerForm').reset();
      });

      document.getElementById('depositForm').addEventListener('submit', function(e) {
        e.preventDefault();
        if (!currentUser) return alert('Login necessário');
        let valor = parseFloat(document.getElementById('depositValue').value);
        if (valor < 100) return alert('Mínimo 100 MT');
        let expira = new Date(); expira.setHours(expira.getHours()+6);
        let u = getUser(currentUser.id);
        u.saldo = Number(u.saldo) + valor;
        u.saldoExpira = expira.toISOString();
        u.primeiroDeposito = true;
        transactions.push({ id:Date.now(), userId:u.id, tipo:'deposito', descricao:'Depósito Paga Fácil', valor, data:new Date().toISOString(), status:'aprovado', details:{} });
        saveAll();
        currentUser = u;
        refreshDashboard();
        alert('Depósito aprovado e saldo disponível!');
        this.reset();
      });

      document.getElementById('withdrawForm').addEventListener('submit', function(e) {
        e.preventDefault();
        if (!currentUser) return alert('Login');
        let valor = parseFloat(document.getElementById('withdrawValue').value);
        let saldo = getSaldo(currentUser.id);
        if (valor < 5) return alert('Mínimo 5 MT');
        if (valor > saldo) return alert('Saldo insuficiente');
        let u = getUser(currentUser.id);
        u.saldo = Number(u.saldo) - valor;
        transactions.push({ id:Date.now(), userId:u.id, tipo:'levantamento', descricao:'Levantamento M-Pesa', valor:-valor, data:new Date().toISOString(), status:'completo' });
        saveAll();
        currentUser = u;
        refreshDashboard();
        alert('Levantamento processado.');
        this.reset();
      });

      // Inicializar
      updateUI();
    })();
  </script>
</body>
</html>